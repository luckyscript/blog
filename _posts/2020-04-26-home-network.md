---
layout: post
title: 家里的网络环境建设
date: 2020-04-26 16:00:00
update: 2020-04-26 16:00:00
summary: 家里的网络环境对平时的生活质量来说是一个挺重要的存在，虽说随便拿个路由器来拨号使用对于大多数人已经足够，但是对于程序员来说，还是有不少可以折腾的空间。
categories: Awesome 
tags: [Awesome]
toc: true
---

## 前言
家里的网络环境对平时的生活质量来说是一个挺重要的存在，虽说随便拿个路由器来拨号使用对于大多数人已经足够，但是对于程序员来说，还是有不少可以折腾的空间。

## 设备
既然建设网络，设备自然是当中比较重要的一点。设备的质量关乎着网络的质量。下面我将介绍我家里的一些设备。

### 软路由
配置：i5-7300u + 64g + 8g
系统是exsi, 虚拟机里有iKuai + Lede + ubuntu server * 2

exsi是VMware专为运行虚拟机、最大限度降低配置要求和简化部署而设计。只需几分钟时间，客户便可完成从安装到运行虚拟机的全过程，虽然对于路由器来说，重启不是经常的事情，但是加入重启要等上很久体验自然是很差。exsi有网页可视化的管理各虚拟系统，使得平时的维护也变得很容易。

iKuai是我的主路由系统，负责拨号+端口映射+DHCP+QOS限流。ikuai是国内一个做的相对不错的路由系统，比较稳定，虽然比起专业的ros仍然不足，但是对于我这种用户也是足够了。

Lede作为我的旁路由，是家里网络体验升级的很重要一环。Lede是openWRT的一个分支，集成了koolshare的插件中心，丰富的插件提供了许多功能，我的lede主要负责出国留学 + ddns + 内网hosts管理。

ubuntu server1 负责我的部分内部网站。

ubuntu server2 负责局域网内的定时脚本，plex Media服务器。

在路由里搭建了几个站点，但是因为空间只有64个g，而分配给ubuntu的空间就更小了，所以像一些图片或者db都是放到nas里的，nas的配置后面会介绍。64g的ssd对我来说确实小了，但是暂时来看也没有升级的必要。plex服务器只是一个空架子，视频文件还都是存在nas里，通过挂载nfs来实现，plex由于是服务端解码，所以交给我的软路由来说刚好能够利用其i5的性能。

### Qnap ts-453bt3
用4块2t盘组了raid5，raid5容量是n - 1的，所以大概就是6t左右。可能这个容量对很多人来说太小了，但是我感觉是绰绰有余了，因为我从上大学到现在，仍然一直保存文件的一块硬盘只有1t，这里面包含了我所有的照片和一些其他觉得重要的文件。所以6t这个数字对目前的我来说完全够了，我也没有收集欲望，非要把很多电影美剧都保存下来，没有那个必要。

目前ssd和万兆口也都没有尝试过，所以感觉自己买的和普通版也没啥差别。系统里面装了一个虚拟的windows，做下载用，不过体验不是很好，因为nas的CPU太烂了。windows10的共享是基于新的smb协议的，比旧版本的快很多，所以也建议大家安装windows10.

除了影音和做云盘之外，我的nas里还放着网站的DB，图片等文件。不过由于最近忙，还有很多功能没有开发出来。

### ASUS AC86U
很著名的一款路由器，现在只是作为AP在使用，其实也有很多人拿AC86U里面刷入梅林系统，可以做到和我的LEDE差不多的事。
因为我现在没有啥设备支持WIFI6的，所以在买路由的时候，还是选择了性价比高一点的。

### Mibox S、Shield TV
卧室和客厅的电视盒子，因为家里的电视是三星的，TIZEN系统很多软件都不支持，而安卓原生的盒子用起来比较舒服，在客厅看Youtube 4K还是很爽的。

## 体验

### 网速
家里接入的是200M的光纤，利用ikuai双播后，速度可以叠加至300M，但是双播经常带来不稳定的因素所以后来还是放弃了。200M和300M的差距真的不大，除了像steam这种下载水管很大的场景，别的几乎没有差异。

### 外网ip
外网ip还是很重要的，毕竟nat过后的网络质量得不到保证，bt下载都会收到影响。并且有时候在外面访问家里也是会有这种场景的。这个不是每个运营商都会提供，所以需要办宽带前就一定得问好。

### 科学上网
科学上网的环境还是得具备，毕竟对于程序员来说，github、google这些网站还是有需求去经常访问的，直连的速度很慢。如果是在电脑和手机里安装某些软件，那么会麻烦很多，而且同时也增加了设备的耗电量，毕竟数据包的加密解密还是一个消耗CPU的场景。这里就不得不提一下，选择软路由的时候CPU最好是支持AES等加解密的指令集。

关于具体科学上网的教程，这里不赘述。毕竟合法的正常使用科学上网从事学习是不犯法的，而提供了工具或方法则是碰了违法的红线。

### 家庭影音
对Kodi、Plex、Emby等各软件都调研后，我最后还是决定选择了Plex。Plex的UI很符合我的审美，做的也很专业，美中不足的是4k电影暂时没发客户端解码，而服务端的CPU资源是很宝贵的。

